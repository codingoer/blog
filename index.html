<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.codingoer.top","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":true,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.0/config.min.js"></script>

    <meta name="description" content="Java Technology">
<meta property="og:type" content="website">
<meta property="og:title" content="Java技术分享">
<meta property="og:url" content="https://www.codingoer.top/index.html">
<meta property="og:site_name" content="Java技术分享">
<meta property="og:description" content="Java Technology">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Lionel">
<meta property="article:tag" content="Java,spring,spring boot,spring cloud">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.codingoer.top/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Java技术分享</title>
  





  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Java技术分享</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Blog For Java</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">10</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">5</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">12</span></a></li><li class="menu-item menu-item-plugins"><a href="/blog/plugins/" rel="section"><i class="fa fa-flask fa-fw"></i>Plugins</a></li><li class="menu-item menu-item-website"><a href="https://www.codingoer.top/" rel="section"><i class="fa fa-house-laptop fa-fw"></i>Website</a></li><li class="menu-item menu-item-next-docs"><a href="/blog/docs/" rel="section"><i class="fa fa-book fa-fw"></i>Next Docs</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lionel"
      src="/blog/images/java-3.svg">
  <p class="site-author-name" itemprop="name">Lionel</p>
  <div class="site-description" itemprop="description">Java Technology</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/codingoer" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;codingoer" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:codingoer@gmail.com" title="E-Mail → mailto:codingoer@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/codingoer" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2021/aliyun-dts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2021/aliyun-dts/" class="post-title-link" itemprop="url">阿里云DTS同步ES详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-24 20:46:25" itemprop="dateCreated datePublished" datetime="2021-07-24T20:46:25Z">2021-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/ES/" itemprop="url" rel="index"><span itemprop="name">ES</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>DTS是数据传输服务，Data Transmission Service的简称Data Transmission Service<br><img src="https://image.codingoer.top/blog/20230204234335.jpg" alt="20230204234335"></p>
<h2 id="Apache-Avro"><a href="#Apache-Avro" class="headerlink" title="Apache Avro"></a>Apache Avro</h2><p><a target="_blank" rel="noopener" href="https://avro.apache.org/docs/current/index.html">官网地址</a></p>
<p>Apache Avro是一个序列化工具，其优点是二进制传输，简洁高效，主要用于RPC序列化等。</p>
<p>它的主要特点有：支持二进制序列化方式，可以便捷，快速地处理大量数据；动态语言友好，Avro提供的机制使动态语言可以方便地处理Avro数据。</p>
<h3 id="Schemas"><a href="#Schemas" class="headerlink" title="Schemas"></a>Schemas</h3><p>相关介绍可以看：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a5c0cbfbf608">https://www.jianshu.com/p/a5c0cbfbf608</a></p>
<p><img src="https://image.codingoer.top/blog/20230204012040.jpg" alt="20230204012040"></p>
<h3 id="对比其他系统的优点"><a href="#对比其他系统的优点" class="headerlink" title="对比其他系统的优点"></a>对比其他系统的优点</h3><p>当前市场上有很多类似的序列化系统，如Google的Protocol Buffers, Facebook的Thrift。</p>
<p>DTS中数据订阅Kafka客户端为什么选择了Avro作为序列化工具？他相比其他序列化系统有什么好处呢？</p>
<p>图片来源官网，看看就好！</p>
<p><img src="https://image.codingoer.top/blog/20230204234605.jpg" alt="20230204234605"></p>
<h3 id="相关扩展（Protocol）"><a href="#相关扩展（Protocol）" class="headerlink" title="相关扩展（Protocol）"></a>相关扩展（Protocol）</h3><p>Google protocol buffer是谷歌开源系列化工具，Google开源gRPC框架序列化工具</p>
<p>定义proto文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// any.proto, api.proto, descriptor.proto, duration.proto, empty.proto, field_mask.proto, source_context.proto, struct.proto, timestamp.proto, type.proto, wrappers.proto</span><br><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"> </span><br><span class="line">option java_multiple_files = true;</span><br><span class="line">option java_package = &quot;com.lionel.test.grpc.grpc&quot;;</span><br><span class="line">option java_outer_classname = &quot;OperationItfDescr&quot;;</span><br><span class="line">option objc_class_prefix = &quot;IOI&quot;;</span><br><span class="line"> </span><br><span class="line">import &quot;google/protobuf/any.proto&quot;;</span><br><span class="line">import &quot;google/protobuf/empty.proto&quot;;</span><br><span class="line">import &quot;google/protobuf/timestamp.proto&quot;;</span><br><span class="line"> </span><br><span class="line">package operationitf;</span><br><span class="line"> </span><br><span class="line">service OperationItf&#123;</span><br><span class="line">    rpc operate (OperateRequest) returns (google.protobuf.Empty) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">message OperationDto &#123;</span><br><span class="line">    enum Source &#123;</span><br><span class="line">        ORDER = 0;</span><br><span class="line">        CMS = 1;</span><br><span class="line">    &#125;</span><br><span class="line">    enum Type &#123;</span><br><span class="line">        LOCK = 0;</span><br><span class="line">        DEDUCT_LOCKED = 1;</span><br><span class="line">        DEDUCT = 2;</span><br><span class="line">    &#125;</span><br><span class="line">    int32 count = 1;</span><br><span class="line">    string descr = 2;</span><br><span class="line">    int64 goodsId = 3;</span><br><span class="line">    Source optSource = 4;</span><br><span class="line">    int64 skuId = 5;</span><br><span class="line">    bool sync = 6;</span><br><span class="line">    Type type = 7;</span><br><span class="line">    string uuid = 8;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">message OperateRequest &#123;</span><br><span class="line">    OperationDto arg0 = 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用插件根据proto文件，生成客户端存根代码，实现rpc调用。</p>
<h2 id="DTS数据订阅Kafka客户端Demo"><a href="#DTS数据订阅Kafka客户端Demo" class="headerlink" title="DTS数据订阅Kafka客户端Demo"></a>DTS数据订阅Kafka客户端Demo</h2><p>从Github上下载即可，在阿里云官方文档上有。</p>
<h2 id="Demo代码结构"><a href="#Demo代码结构" class="headerlink" title="Demo代码结构"></a>Demo代码结构</h2><p>下载Demo工程后，导入IDEA，先看下目录结构</p>
<p><img src="https://image.codingoer.top/blog/20230204234835.jpg" alt="20230204234835"></p>
<ul>
<li>avro目录<br>里面包含了反序列文件和工具</li>
<li>javaimpl<br>Java实现代码</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2021/aliyun-dts/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2020/spring-transaction-propagation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/spring-transaction-propagation/" class="post-title-link" itemprop="url">记录一次Spring事务分析过程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-26 21:00:02" itemprop="dateCreated datePublished" datetime="2020-03-26T21:00:02Z">2020-03-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="事件背景"><a href="#事件背景" class="headerlink" title="事件背景"></a>事件背景</h2><p>今天下午写代码，在调试的过程中遇到了一个很熟悉的异常</p>
<blockquote>
<p>Transaction rolled back because it has been marked as rollback-only<br>这个异常大家都非常熟悉，是由于当前事务要提交的时候，发现这个事务已经被标记成回滚的事务了，所以提交事务的时候会抛出此异常。</p>
</blockquote>
<p>借此机会就复习下关于事务的配置和传播级别等知识点。</p>
<h2 id="事务的配置"><a href="#事务的配置" class="headerlink" title="事务的配置"></a>事务的配置</h2><p>Spring框架中提供了两种配置事务的方法，一种是<mark class="label primary"> 声明式事务</mark>，一种是<mark class="label info"> 注解式事务</mark>。</p>
<h3 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h3><p>一般项目中我们都会配置声明式事务，它是基于<strong>Spring Aop</strong>来实现的。</p>
<div class="tabs" id="spring-transaction"><ul class="nav-tabs"><li class="tab active"><a href="#spring-transaction-1">Spring Boot配置</a></li><li class="tab"><a href="#spring-transaction-2">Spring Framework配置</a></li></ul><div class="tab-content"><div class="tab-pane active" id="spring-transaction-1"><p>总的来说，首先定义切面,然后注入<code>transactionManager</code>，配置切入点和通知。将切入点和通知绑定在一起。</p>
<figure class="highlight java"><figcaption><span>事务配置伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionAdviceConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlatformTransactionManager transactionManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TransactionInterceptor <span class="title function_">txAdvice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TransactionInterceptor</span> <span class="variable">transactionInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransactionInterceptor</span>();</span><br><span class="line">        transactionInterceptor.setTransactionManager(transactionManager);</span><br><span class="line">        transactionInterceptor.setTransactionAttributeSource(source);</span><br><span class="line">        <span class="keyword">return</span> transactionInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Advisor <span class="title function_">txAdviceAdvisor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultPointcutAdvisor</span> <span class="variable">advisor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultPointcutAdvisor</span>();</span><br><span class="line">        advisor.setPointcut(pointcut);</span><br><span class="line">        advisor.setAdvice(txAdvice());</span><br><span class="line">        <span class="keyword">return</span> advisor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="spring-transaction-2"><p>基于XML文件配置</p>
<figure class="highlight xml"><figcaption><span>事务配置伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.hibernate5.HibernateTransactionManager&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:session-factory-ref</span>=<span class="string">&quot;dbSessionFactory&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;dbTxAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;persist*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;dbTxPointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xx.xx.service..*Service.*(..))&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;dbTxAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;dbTxPointcut&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div>

<h3 id="注解式事务"><a href="#注解式事务" class="headerlink" title="注解式事务"></a>注解式事务</h3><div class="note danger no-icon"><p>如果使用配置文件要开启注解</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;cartTxManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>这种也很常见，在特殊的方法处理中添加<code>@Transactional</code>注解</p>
<figure class="highlight java"><figcaption><span>注解式事务方法</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span></span><br><span class="line"><span class="keyword">public</span> Item <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    Optional&lt;Item&gt; optional = dao.findById(id);</span><br><span class="line">    <span class="keyword">return</span> optional.orElse(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查看方法中的事务"><a href="#查看方法中的事务" class="headerlink" title="查看方法中的事务"></a>查看方法中的事务</h2><p>一般项目中都会配置<mark class="label primary"> 声明式事务</mark>，这样可以全局处理，不用为每一个方法单独配置事务。但是再处理一些特殊的业务时，会需要加上<mark class="label info"> 注解式事务</mark>覆盖原来的事务，上一层的事务会被挂起，等当前的事务提交之后再执行上一层事务。</p>
<p>可以通过<strong>Debug</strong>的方式来查看当前方法一共有几层事务，在业务方法中打个断点。</p>
<p>看看有几次<code>invokeWithinTransaction</code>，如下图所示，那说明当前方法中有两层事务。</p>
<ul>
<li><p>第一次<br><img src="https://image.codingoer.top/blog/20230205010816.jpg" alt="20230205010816"></p>
</li>
<li><p>第二次<br><img src="https://image.codingoer.top/blog/20230205010837.jpg" alt="20230205010837"></p>
</li>
</ul>
<h2 id="事务的传播级别"><a href="#事务的传播级别" class="headerlink" title="事务的传播级别"></a>事务的传播级别</h2><p>关于事务的传播级别可以看源码<code>Propagation</code>，每一种情况都要自己好好分析，跑一个单列测试。下面我就列举几个比较常用的</p>
<ul>
<li>REQUIRED</li>
</ul>
<p>支持当前的事务，如果当前没有事务会创建一个新的事务。</p>
<ul>
<li>SUPPORTS</li>
</ul>
<p>支持当前的事务，如果没有事务就不开启事务。</p>
<ul>
<li>REQUIRES_NEW</li>
</ul>
<p>创建一个新的事务，如果当前有事务会挂起当前事务。</p>
<ul>
<li>NOT_SUPPORTED</li>
</ul>
<p>不使用事务，如果当前有事务会挂起当前事务。</p>
<h2 id="异常的原因"><a href="#异常的原因" class="headerlink" title="异常的原因"></a>异常的原因</h2><p>回到最开始的问题，这个<code>Transaction rolled back because it has been marked as rollback-only</code>异常是如何产生的。</p>
<figure class="highlight java"><figcaption><span>问题代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrUpdate</span><span class="params">(List&lt;BrandDtk&gt; brandList)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (DtkBrandVo dtkBrandVo : brandList) &#123;</span><br><span class="line">        <span class="type">BrandDtk</span> <span class="variable">brandDtk</span> <span class="operator">=</span> service.get(brandId);</span><br><span class="line">        <span class="keyword">if</span> (brandDtk == <span class="literal">null</span>) &#123;</span><br><span class="line">            brandDtk = <span class="keyword">new</span> <span class="title class_">BrandDtk</span>();</span><br><span class="line">            brandDtk.setId(brandId);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                service.save(toBrand(brandDtk, dtkBrandVo));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ConstraintViolationException e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            service.update(toBrand(brandDtk, dtkBrandVo));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注解配置中将<strong>Save</strong>开头的方法的传递级别设置成<mark class="label danger">REQUIRED</mark>,也就是说<code>saveOrUpdate</code>方法会开始一个事务，方法内如果有事务延用当前的事务。</p>
<p>同理，方法内部的<code>save</code>方法也会开始一个事物，但是外部有事务，会使用外部的事务。也就是说<code>saveOrUpdate</code>方法和<code>save</code>方法使用的是同一个事务。</p>
<p>由于唯一索引冲突，<code>save</code>方法抛出异常，但是在<code>saveOrUpdate</code>方法中捕获的异常，看起来没什么问题。但是<code>save</code>方法抛出异常的同时将事务标记成了<mark class="label danger">回滚状态</mark>,由于两个方法是同一个事务，所以<code>saveOrUpdate</code>方法在提交事务的时候会跑出此异常。</p>
<p>真正的异常是唯一索引冲突异常，但是在内部已经被吃掉了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>解决这个问题，只要在方法上将事务改为<mark class="label danger">NOT_SUPPORTED</mark>即可。</p>
<p>在写业务方法的时候，一定要考虑清楚当前场景是否需要使用事务，以及如何使用事务的传播级别。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2020/learning-method-thinking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/learning-method-thinking/" class="post-title-link" itemprop="url">最近的一些思考</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-20 22:23:02" itemprop="dateCreated datePublished" datetime="2020-03-20T22:23:02Z">2020-03-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="note default no-icon"><p>思考比写代码重要的多,每天多花时间思考🤔，而不是写重复的代码</p>
</div>

<p>这几天我一直在思考几个问题，感想还是挺多的。</p>
<h2 id="阅读公众号"><a href="#阅读公众号" class="headerlink" title="阅读公众号"></a>阅读公众号</h2><p>这几天我把我之前关注的公众号大部分都取消关注了，之前差不多关注了将近200个技术的公众号，现在一共只剩下几十个吧。</p>
<p><strong>为什么不关注了？</strong></p>
<p>我觉得没有什么用，有用的东西太少，浪费时间。虽然平时在地铁上可以看看，也可以学到一点东西，比如一些概念性的东西，一些入门的东西，但是不成体系，能用到的更是甚少。</p>
<p>其次是关注太多了，推送的文章太杂了，容易让人迷失方向。</p>
<p>虽然有些文章不错，但是你没有亲身经历，理解的不是很深。我平时看到比较好的文章就收藏了，可是收藏了那些从来没看过。如果花时间重新翻一遍，真的太浪费时间了。</p>
<p>现在只留下了一些新闻的公众号和一些个人比较喜欢的技术号，只要能关注着技术发展动向就足够了。</p>
<h2 id="做笔记的方法"><a href="#做笔记的方法" class="headerlink" title="做笔记的方法"></a>做笔记的方法</h2><p>无论是看书，还是学一门技术一定要总结，也就是做笔记，那么怎么做笔记效果才最好呢？</p>
<p>我最开始弄了一个笔记本，但是弄着弄着发现不对劲了，就好像从一个地方拷贝到另一个地方，这样做根本没有什么意义，也浪费时间。</p>
<p>用电脑做笔记效果没有用手写记忆力好。读纸书比电子书好。</p>
<p>我计划以后在电脑笔记本上记下来大纲或总结，比如一本书，一门技术的大纲，具体的内容可以在书上做总结。</p>
<h2 id="多和别人比较"><a href="#多和别人比较" class="headerlink" title="多和别人比较"></a>多和别人比较</h2><p>多看看身边比你厉害的人，如果遇到问题或者新的知识点，他们是怎么处理的怎么学习的。</p>
<p>多想想以前遇到的人，他们身上有什么共同的特点，也许就是你欠缺的地方。</p>
<h2 id="不纠结"><a href="#不纠结" class="headerlink" title="不纠结"></a>不纠结</h2><p>最后一点，不要纠结。想学习什么就学，不要纠结买什么书好，买几本书，认认真真读完一本书就可以了，不要冲动。我相信很多人和我一样，一股脑买了好几本书，可是没有认认真真看完一本，这是我之前的毛病。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2020/m-goods-model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/m-goods-model/" class="post-title-link" itemprop="url">记一次泛型引发的线上事故</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-02-07 20:10:58" itemprop="dateCreated datePublished" datetime="2020-02-07T20:10:58Z">2020-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote class="blockquote-center">
<p>一次修改项目中的模型，导致的线上大面积事故</p>

</blockquote>

<p>首先说明下我们公司使用的是<mark class="label info">Nexus</mark>搭建的<mark class="label default">Maven私服</mark>，因为各个项目中的模型都是相互使用的。如果在一个项目中修改了某一个模型，那么就要把这个模型<mark class="label danger">deploy</mark>到远程仓库中去，其他人在别的项目中使用这个模型的话，就重新导入下依赖，这样就可以使用对方在模型中修改的属性或者方法了。</p>
<p>比如，我在<mark class="label success">商品项目</mark>中，添加了一个商品查询结果的模型，里面定义了一些属性和方法，我这边改好相应的代码之后，将这个模型发布到了远程仓库。然后小李在<mark class="label success">订单项目</mark>中想使用这个模型，只要重新导入下依赖就可以使用了。</p>
<h2 id="事件回顾"><a href="#事件回顾" class="headerlink" title="事件回顾"></a>事件回顾</h2><p>当天晚上结束办公之后，由于是在家办公，六点多就下班了，我正在吃饭。突然客服运营群里说线上的搜索挂了，吓得我饭都吃不下了😟😟.</p>
<p>这几天正在开发新的需求，并没有上线什么功能，怎么好端端的会出现问题呢。当看到群里的截图时，我才发现这是一个<mark class="label danger">JSON转换异常</mark>,看着报错的信息我怎么这么熟悉呢，这不就是我这几天做需求改动的模型吗？🥵没时间多考虑，赶紧电话和我们项目经理确认下，他说他上线了一个小需求，我告诉他线上除了问题，代码马上回滚了，过了几分钟一切就恢复正常了。</p>
<h2 id="事件的原因"><a href="#事件的原因" class="headerlink" title="事件的原因"></a>事件的原因</h2><div class="note danger no-icon"><p>正因为是我改动的这个模型，导致了线上搜索全部挂了。</p>
</div>

<p>这几天我正在改商品库相关的业务需求，由于这次添加了导购的商品，所以要添加一个搜索方法。只不过这部分代码之前都是存在的，是搜索商品用的，当时我就想能不能复用这部分代码。</p>
<p>因为我们的<mark class="label info">搜索条目</mark>都在一个索引里面，不同的<mark class="label info">搜索条目</mark>是用类型区分的，他们都有一个共同的父类。如下图</p>
<p><img src="https://image.codingoer.top/blog/20230205010205.jpg" alt="20230205010205"></p>
<p>这次只不过是新加一种商品搜索类型，所以我将商品的共同属性抽取到一个父类里面，如下图</p>
<p><img src="https://image.codingoer.top/blog/20230205010239.jpg" alt="20230205010239"></p>
<p>所以我将搜索方法全部改成<mark class="label warning">泛型代码</mark></p>
<blockquote>
<p>Talk is cheap, Show me code</p>
</blockquote>
<div class="tabs" id="search-method"><ul class="nav-tabs"><li class="tab active"><a href="#search-method-1">原始搜索方法</a></li><li class="tab"><a href="#search-method-2">泛型搜索方法</a></li></ul><div class="tab-content"><div class="tab-pane active" id="search-method-1"><figure class="highlight java"><figcaption><span>搜索DTO伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedSearchGoodsDto</span> <span class="keyword">extends</span> <span class="title class_">SearchItemDto</span>&lt;SearchGoods&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>搜索结果VO伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsSearchResultVo</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;SearchGoods&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>搜索Service伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchItemService</span> &#123;</span><br><span class="line">    GoodsSearchResultVo <span class="title function_">searchGoodsAdvanced</span><span class="params">(AdvancedSearchGoodsDto dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>搜索Dao伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchItemDao</span> &#123;</span><br><span class="line">    GoodsSearchResultVo <span class="title function_">searchGoodsAdvanced</span><span class="params">(AdvancedSearchGoodsDto dto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="search-method-2"><figure class="highlight java"><figcaption><span>搜索DTO伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedSearchGoodsDto</span>&lt;T <span class="keyword">extends</span> <span class="title class_">SearchBaseGoods</span>&gt; <span class="keyword">extends</span> <span class="title class_">SearchItemDto</span>&lt;T&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>搜索结果VO伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsSearchResultVo</span>&lt;T <span class="keyword">extends</span> <span class="title class_">SearchBaseGoods</span>&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>搜索Service伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchItemService</span> &#123;</span><br><span class="line">    &lt;T <span class="keyword">extends</span> <span class="title class_">SearchBaseGoods</span>&gt; GoodsSearchResultVo&lt;T&gt;(AdvancedSearchGoodsDto&lt;T&gt; dto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>搜索Dao伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchItemDao</span> &#123;</span><br><span class="line">    &lt;T <span class="keyword">extends</span> <span class="title class_">SearchBaseGoods</span>&gt; GoodsSearchResultVo&lt;T&gt;(AdvancedSearchGoodsDto&lt;T&gt; dto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2020/m-goods-model/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2020/2019-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2020/2019-summary/" class="post-title-link" itemprop="url">2019年终总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-01-07 18:02:58" itemprop="dateCreated datePublished" datetime="2020-01-07T18:02:58Z">2020-01-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>2019年就这样过去了，过的很快😂😂这里做一次总结。</p>
<p>每年年底我们项目经理也要求我们写写年终总结，但工作总结更偏官方吧，哈哈。这里就纯粹针对自己做的总结。  </p>
<div class="note info"><p>我就从<mark class="label success">个人</mark>和<mark class="label info">工作</mark>这两个方便对自己总结下。</p>
</div>

<h2 id="工作总结"><a href="#工作总结" class="headerlink" title="工作总结"></a>工作总结</h2><p>先从工作说起，毕竟工作时间占据这一天大部分的时间。这一年工作还是很充实的，自己不断地提升，确实也学习到了不少知识。</p>
<h3 id="公司笔记"><a href="#公司笔记" class="headerlink" title="公司笔记"></a>公司笔记</h3><p>刚到公司的时候，我就用<a target="_blank" rel="noopener" href="https://docsify.js.org/">Docsify</a>搭建了一个公司的笔记本。请看另一篇文章<a href="/blog/2019/static-website-compare/" title="静态网站生成器总结">静态网站生成器总结</a></p>
<p>这里面记录了公司的一些笔记，比如各个项目的一些业务，各个组件使用上要注意什么，公司的服务器信息，账号等等。</p>
<p>因为我们每周都要开周会，报告每周的问题和项目的一些异常。我也把每周的问题记录保存了下来，后面自己看看每周遇到的问题，做下总结。</p>
<p>我在我的服务器上搭建了一个项目,每次修改的时候就提交到远程仓库,回到家拉取代码还可以继续修改,很方便.</p>
<h3 id="公司项目"><a href="#公司项目" class="headerlink" title="公司项目"></a>公司项目</h3><p>到目前我个人负责公司的<strong>五六个项目</strong>。从每个项目中，我都学到了知识，每个项目都有各自的特点。</p>
<p>从年初2月份开始自己独立负责一个完整的项目，从框架搭建到业务代码编写，都是自己来完成。虽然说项目比较简单，对应的需求不是那么太复杂，只是有一些最核心的基本工作。但是从头到尾自己一个人负责，也是挺有成就感。后期项目上线，每天也要查看线上异常情况，时刻关注着线上的动态。</p>
<p>四月末的时候，接手了公司比较核心的项目，<mark class="label primary">移动端接口项目</mark>可谓是核心项目，直接关系到用户的体验。如果哪个接口写不好，可能会导致公司整个服务瘫痪，一不小心就会导致用户不能正常使用APP，所以做好这个项目一定要用心。每次需求上线一定要立刻观察线上日志!!</p>
<p>通过这个移动端项目也知道了APP那边的机制，他们是如何渲染页面的。通过写APP这边的接口调试,知道了写接口注意的东西, 比如</p>
<ul>
<li>代码的可读性</li>
<li>如何合理使用缓存</li>
<li>其他服务和组件的压力</li>
<li>APP那边的机制</li>
</ul>
<p>八月份的时候，因为一次<code>商品详情页</code>的大改动，也慢慢接手了最最复杂的项目，没有之一，业务太复杂了。可能看一个业务逻辑，要看一两个小时，涉及到的点太多了。改动一个很小很小的地方，都胆战心惊，就怕出现什么问题。</p>
<p>总的来说，从项目这一块，我收获的还是很多的。从这些项目中，接触到了各种组件。比如<mark class="label info">RocketMQ</mark>,<mark class="label info">MongoDB</mark>,<mark class="label info">ELK</mark>,<mark class="label info">缓存</mark>等。也对<code>分布式</code>有了深入的理解，还有就是一些开发流程和规范，这一年都进步了不少。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2020/2019-summary/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2019/thread-local-param/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/thread-local-param/" class="post-title-link" itemprop="url">多线程中ThreadLocal的传参</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-11-21 18:12:09" itemprop="dateCreated datePublished" datetime="2019-11-21T18:12:09Z">2019-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>APP客户端发起Http请求，服务端这边执行业务方法。将一些信息比如参数等放入<code>ThreadLocal</code>中保存，后续的方法可以随时获取这个参数，这样对代码的侵入性很小。</p>
<p>如果在业务方法中，使用<mark class="label info">线程池</mark>来处理其他业务，加速服务端相应时间。那么在线程池中如何获取到<code>Http线程</code>中存放的参数呢。</p>
<div class="note primary"><p>可以通过<mark class="label success"><strong>Callable + Future</strong></mark>来实现</p>
</div>

<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>App发起请求，进入业务方法，此时已经将参数放入<code>ThreadLocal</code>中</p>
<figure class="highlight java"><figcaption><span>service方法</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Module&gt; <span class="title function_">getModuleByIds</span><span class="params">(Long[] moduleIds)</span> &#123;</span><br><span class="line">    List&lt;ModulePage&gt; modulePages = dao.get(moduleIds);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;Callable&lt;Module&gt;&gt; callables = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(modulePages.size());</span><br><span class="line">        modulePages.forEach(modulePage -&gt; &#123;</span><br><span class="line">            callables.add(<span class="keyword">new</span> <span class="title class_">ModuleCallable</span>(modulePage));</span><br><span class="line">        &#125;);</span><br><span class="line">        List&lt;Module&gt; rModuleList = PoolUtils.execute(callables);</span><br><span class="line">        TimeCountUtils.escape(<span class="string">&quot;execute&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        ThreadLocalUtils.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modules;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个<code>ModuleCallable</code>对象，实现<code>Callable</code>接口，构造方法中从Http线程中获取参数并赋值。</p>
<figure class="highlight java"><figcaption><span>ModuleCallable对象代码实现</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModuleCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Module&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; requestHeaders;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ModuleCallable</span><span class="params">(ModulePage modulePage)</span> &#123;</span><br><span class="line">        requestHeaders = HttpRequestUtils.requestHeaders();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Module <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        HttpRequestUtils.requestHeaders(requestHeaders);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ModuleParseUtils.parse(modulePage);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            HttpRequestUtils.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在执行<code>call</code>回调方法中，将本地参数赋值到线程池中的线程的<code>ThreadLocal</code>中，这样就可以在后续方法中，再次获取到这个参数。</p>
<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><p>无论是在http请求中还是在线程池中，处理完业务最终都要释放<code>ThreadLocal</code>中的参数，以免被其他线程复用，导致业务错误。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2019/online-cpu-examine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/online-cpu-examine/" class="post-title-link" itemprop="url">线上服务器CPU100&#37排查</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-10-12 20:16:33" itemprop="dateCreated datePublished" datetime="2019-10-12T20:16:33Z">2019-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>当天晚上<mark class="label info">购物车</mark>项目所在的服务器<mark class="label danger">CPU突然飙升</mark>，就在不久刚刚修复了一个线上的问题，难道是修复这个问题引起的吗？</p>
<p>由于我没有<code>线上服务器</code>的登录权限，项目经理将线程栈信息导出来发给了我，最后定位了问题。是进入<mark class="label primary">购物车列表</mark>这个操作引起的，找到问题并修复，最后CPU利用率也恢复了正常。</p>
<p>网上有很多关于定位CPU100%的文章，我关注了很多公众号，每个公众号几乎都推送过类似的文章。所以说，这是一项必会的本领，这里我自己总结下关于服务器CPU达到100%的原因以及如何解决这类的问题，就拿这次事件举例并分析。</p>
<h2 id="情景再现"><a href="#情景再现" class="headerlink" title="情景再现"></a>情景再现</h2><div class="note primary"><p>本地机器复现线上情况</p>
</div>

<p>本地启动代码，修改<code>nginx</code>配置，将测试环境机器指向到我的本地电脑。模拟线上数据，开始做测试。</p>
<p>进入购物车列表几次之后，本地CPU的利用率已经达到了100%，这时候机器已经很卡了。</p>
<p><img src="https://image.codingoer.top/blog/20230205004550.jpg" alt="20230205004550"></p>
<h2 id="定位过程"><a href="#定位过程" class="headerlink" title="定位过程"></a>定位过程</h2><div class="note info"><h3 id="执行top命令"><a href="#执行top命令" class="headerlink" title="执行top命令"></a>执行<code>top</code>命令</h3></div>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line marked">top -c</span><br></pre></td></tr></table></figure>

<p><img src="https://image.codingoer.top/blog/20230205004616.jpg" alt="20230205004616"></p>
<p>因为线上一台服务器会部署很多应用，先确定是不是我们的Java程序。</p>
<p>结果相吻合,就是<code>6560</code>的Java进程</p>
<p><img src="https://image.codingoer.top/blog/20230205004637.jpg" alt="20230205004637"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2019/online-cpu-examine/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2019/thread-local-clear/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/thread-local-clear/" class="post-title-link" itemprop="url">记一次ThreadLocal导致的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-08-07 18:02:58" itemprop="dateCreated datePublished" datetime="2019-08-07T18:02:58Z">2019-08-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>当天测试反馈一个<mark class="label danger">Bug</mark>🐞，是我们APP首页有一个模型，正常情况是要根据每个用户浏览的商品来推荐一些相关的商品。首页的这个模型默认展示前两个商品，点进去会进入到推荐商品列表页,看下图</p>
<div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="https://image-m.1haitao.com/m/50881151504359879833.png" class=""></div><div class="group-picture-column"><img src="https://image.codingoer.top/blog/20230205011447.jpg" class=""></div></div></div>

<p>测试发现，每次刷新首页的时候，这两个商品有时候会变化，与点击进去的列表页的头两个商品对不上。</p>
<h2 id="定位问题"><a href="#定位问题" class="headerlink" title="定位问题"></a>定位问题</h2><div class="note warning"><p>出现问题不要慌,要找准问题的关键点.</p>
</div>

<p>首先,这个模型展示的商品是根据<mark class="label info">用户</mark>来决定的,不同的用户所看到的商品是不一样的.进入列表页之后看到的商品列表也是根据<mark class="label info">用户</mark>来决定的.</p>
<p>那现在出现的问题是</p>
<ol>
<li>首页这个模型上展示的商品,刷新首页会不停变化</li>
<li>进入到列表页和列表页的商品对不上.</li>
</ol>
<p>经过上面的分析之后,可以大概知道是根据用户ID查询的数据出现了问题.多半就是由于这个用户ID引起的,要不为什么数据会变化呢??有可能首页的模型数据是别的用户的,而列表页的数据是自己的.</p>
<p>所以就按照这个方向来定位问题,那么就开始检查代码吧,先看下存储用户信息的这部分代码</p>
<p>因为我们的服务部署在<mark class="label success">Tomcat</mark>服务器上,<mark class="label info">Tomcat</mark>又是基于<code>线程</code>的.所以我们后端服务将用户信息放在了<mark class="label success">ThreadLocal</mark>中.</p>
<figure class="highlight java"><figcaption><span>用户工具类伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServletUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;User&gt; userCache = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userCache.get();</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">        user = ucenterService.user();</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            userCache.set(user);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样用户的信息就<strong>贯穿整个请求</strong>,后面用到用户信息就直接工具类获取,代码写起来<strong>更简单</strong>.<br>但是这样用户信息就和当前线程绑定了,随着线程而消亡,这点非常重要,所以我们每次请求之后都会清空本地线程栈的信息</p>
<figure class="highlight java"><figcaption><span>servlet伪代码</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">ContextDispatcherServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.doService(request, response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            UserServletUtils.clear();</span><br><span class="line">            <span class="built_in">super</span>.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2019/thread-local-clear/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2019/hexo-next-post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/hexo-next-post/" class="post-title-link" itemprop="url">使用Markdown写作的一些事</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-07-18 20:30:02" itemprop="dateCreated datePublished" datetime="2019-07-18T20:30:02Z">2019-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Website/" itemprop="url" rel="index"><span itemprop="name">Website</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>因为我是使用<mark class="label info">hexo</mark> + <mark class="label success">next</mark>构建的网站，所以在这里我总结下<mark class="label info">hexo</mark>和<mark class="label success">next</mark>支持的一些语法特性。</p>
<h2 id="基础的Markdown语法"><a href="#基础的Markdown语法" class="headerlink" title="基础的Markdown语法"></a>基础的Markdown语法</h2><p><a target="_blank" rel="noopener" href="https://daringfireball.net/projects/markdown/basics">官方网站</a><br><a target="_blank" rel="noopener" href="https://markdown-it.github.io/">在线demo</a></p>
<h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>一共是两种语法，我一般就使用<mark class="label primary">#</mark></p>
<ul>
<li><strong>Setext-style</strong> - 标示样式</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">A First Level Header</span></span><br><span class="line"><span class="section">====================</span></span><br><span class="line"></span><br><span class="line"><span class="section">A Second Level Header</span></span><br><span class="line"><span class="section">---------------------</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>atx-style</strong> - #样式</li>
</ul>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="section"># header1</span></span><br><span class="line"></span><br><span class="line"><span class="section">## header2</span></span><br></pre></td></tr></table></figure>

<h3 id="段落"><a href="#段落" class="headerlink" title="段落"></a>段落</h3><p>直接写文字就可以了，如果要换行就空一行呗。</p>
<p>好吧，那我换一行开始，随便你吧。</p>
<p>如果处理换行，输入两个或以上的空格就可以了。</p>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; This is a blockquote.</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>This is a blockquote.</p>
</blockquote>
<h3 id="短语加强"><a href="#短语加强" class="headerlink" title="短语加强"></a>短语加强</h3><figure class="highlight md"><table><tr><td class="code"><pre><span class="line">Some of these words <span class="emphasis">*are emphasized*</span>.</span><br><span class="line">Some of these words <span class="emphasis">_are emphasized also_</span>.</span><br><span class="line">Use two asterisks for <span class="strong">**strong emphasis**</span>.</span><br><span class="line">Or, if you prefer, <span class="strong">__use two underscores instead__</span>.</span><br></pre></td></tr></table></figure>
<p><em>italic</em>   <strong>bold</strong><br><em>italic</em>   <strong>bold</strong></p>
<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>列表可以分成<mark class="label info">无序</mark>和<mark class="label info">有序</mark>。</p>
<p>无序列表有三种<code>*</code>,<code>+</code>,<code>-</code></p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="bullet">*</span>   Candy.</span><br><span class="line"><span class="bullet">*</span>   Gum.</span><br><span class="line"><span class="bullet">*</span>   Booze.</span><br><span class="line"></span><br><span class="line"><span class="bullet">+</span>   Candy.</span><br><span class="line"><span class="bullet">+</span>   Gum.</span><br><span class="line"><span class="bullet">+</span>   Booze.</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span>   Candy.</span><br><span class="line"><span class="bullet">-</span>   Gum.</span><br><span class="line"><span class="bullet">-</span>   Booze.</span><br></pre></td></tr></table></figure>

<p>有序列表</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span>  Red</span><br><span class="line"><span class="bullet">2.</span>  Green</span><br><span class="line"><span class="bullet">3.</span>  Blue</span><br></pre></td></tr></table></figure>

<p>如果列表中加入p元素，看下面</p>
<ul>
<li><p>A list item.</p>
<p>With multiple paragraphs.</p>
</li>
<li><p>Another item in the list.</p>
</li>
</ul>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p>链接有两种样式，<mark class="label info">内联式</mark>和<mark class="label info">引用式</mark></p>
<ul>
<li>内联式</li>
</ul>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">An [<span class="string">example</span>](<span class="link">http://url.com/ &quot;Title&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>引用式</li>
</ul>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">An [<span class="string">example</span>][<span class="symbol">id</span>]. Then, anywhereelse in the doc, define the link:</span><br><span class="line"></span><br><span class="line">[<span class="symbol">id</span>]: <span class="link">http://example.com/  &quot;Title&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><p>图片有两种样式，一种是内联式，一种是引用的。我一般就使用内联式</p>
<ol>
<li>内联式</li>
</ol>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">![<span class="string">alt text</span>](<span class="link">/path/to/img.jpg &quot;Title&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>引用的</li>
</ol>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">![<span class="string">alt text</span>][<span class="symbol">id</span>]</span><br><span class="line"></span><br><span class="line">[<span class="symbol">id</span>]: <span class="link">/path/to/img.jpg &quot;Title&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h3><p>四个空格或者一个tab</p>
<p>This is a normal paragraph:</p>
<pre><code>This is a code block.
</code></pre>
<p>Here is an example of AppleScript:</p>
<pre><code>tell application &quot;Foo&quot;
    beep
end tell
</code></pre>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>使用反引号，或者多个的到引号</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">Use the <span class="code">`printf()`</span> function.</span><br></pre></td></tr></table></figure>

<p>Use the <code>printf()</code> function.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;Hello Word!!!&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="水平线"><a href="#水平线" class="headerlink" title="水平线"></a>水平线</h3><p>水平线就三种</p>
<hr>
<hr>
<hr>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2019/hexo-next-post/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.codingoer.top/2019/static-website-compare/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/java-3.svg">
      <meta itemprop="name" content="Lionel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Java技术分享">
      <meta itemprop="description" content="Java Technology">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Java技术分享">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/static-website-compare/" class="post-title-link" itemprop="url">静态网站生成器对比</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-07-14 16:18:06" itemprop="dateCreated datePublished" datetime="2019-07-14T16:18:06Z">2019-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Website/" itemprop="url" rel="index"><span itemprop="name">Website</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最开始因为<a href="/2019/06/28/about-my-blog/">搭建博客</a>，上网查阅了很多关于<mark class="label info">静态网站生成器</mark>的相关文章，后续自己又尝试了几款不同的静态网站生成器，并对其有了一定的了解。</p>
<ul>
<li>我的博客是用<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a>搭建的</li>
<li>我的笔记本是用<a target="_blank" rel="noopener" href="https://vuepress.vuejs.org/">Vuepress</a>搭建的</li>
<li>公司的笔记本是用<a target="_blank" rel="noopener" href="https://docsify.js.org/#/">Docsify</a>搭建的</li>
</ul>
<p>先截图看下</p>
<div class="tabs" id="ssgs-example"><ul class="nav-tabs"><li class="tab active"><a href="#ssgs-example-1">Hexo</a></li><li class="tab"><a href="#ssgs-example-2">Vuepress</a></li><li class="tab"><a href="#ssgs-example-3">Docsify</a></li></ul><div class="tab-content"><div class="tab-pane active" id="ssgs-example-1"><img src="https://image.codingoer.top/blog/20230205012356.jpg" class=""></div><div class="tab-pane" id="ssgs-example-2"><img src="https://image.codingoer.top/blog/20230205012446.jpg" class=""></div><div class="tab-pane" id="ssgs-example-3"><img src="https://image.codingoer.top/blog/20230205012525.jpg" class=""></div></div></div>

<div class="note primary no-icon"><p>下面主要介绍下静态网站生成器，并主要说明我试过的这几个，做一下对比</p>
</div>

<h2 id="什么是静态网站生成器"><a href="#什么是静态网站生成器" class="headerlink" title="什么是静态网站生成器"></a>什么是静态网站生成器</h2><blockquote>
<p>静态网站 - static site<br><strong>静态网站</strong> 是包含html页面的集合</p>
</blockquote>
<blockquote>
<p>静态网站生成器 - static site generator(SSG)<br><strong>静态网站生成器</strong> 使用原始数据（比如Markdown文件）和模板，产生Html页面的工具。</p>
</blockquote>
<p>我个人的理解，主要是将<mark class="label danger">markdown</mark>渲染成<code>html</code>页面，并根据<code>模板</code>生成一些静态页面。</p>
<p>找了一张网络上的图片，很形象</p>
<p><img src="https://image.codingoer.top/blog/20230205012245.jpg" alt="20230205012245"></p>
<p>从图片上我们不难理解，将一些资源文件，这些文件包括<code>布局</code>,<code>javascript</code>,<code>css</code>,<code>image</code>,<code>md文件</code>等等，最终生成<code>html页面</code>.</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2019/static-website-compare/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">黑ICP备 2021006860号-1 </a>
  </div>

<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lionel</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div><div class="footer-custom">
Website source code <span class="exturl theme-link" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG8tbmV4dC9oZXhvLW5leHQuZ2l0aHViLmlv">here</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.0/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.0/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.0/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.11.0/next-boot.min.js"></script>

  





  





</body>
</html>
